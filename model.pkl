# أول شيء، استيراد المكتبات
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
import pickle
import pandas as pd

# --------------------------------------
# تحميل البيانات الأصلية (CSV)
# --------------------------------------
autism = pd.read_csv("/content/gdrive/MyDrive/AUTISMM.csv")
autism = autism.drop(['num'], axis=1)

# تعبئة القيم الناقصة
mylist = ['Male','Female']
list2 = ['30-40','20-30']
import random
autism.motherage = autism.motherage.fillna(random.choice(list2))
autism.smoke = autism.smoke.fillna('No')
autism.autisticsibiling = autism.autisticsibiling.fillna('No')
autism.painkillers = autism.painkillers.fillna('No')
autism.Gender = autism.Gender.fillna(random.choice(mylist))
autism.antibiotics = autism.antibiotics.fillna('No')
autism.radiation = autism.radiation.fillna('No')
autism.twinautistic = autism.twinautistic.fillna('no_twin')

# تحويل القيم التصنيفية لأرقام
from sklearn.preprocessing import LabelEncoder
features_cat = autism.select_dtypes(['object']).apply(LabelEncoder().fit_transform)
features_num = autism.select_dtypes(exclude=['object'])
autismnew = features_cat.join(features_num)

# --------------------------------------
# تحضير X و y
# --------------------------------------
X = autismnew.copy()
y = X.pop('autistic')

# --------------------------------------
# تدريب موديل RandomForest
# --------------------------------------
X_train, X_valid, y_train, y_valid = train_test_split(X, y, train_size=0.7, test_size=0.3, random_state=0)
model = RandomForestClassifier(n_estimators=100, random_state=0)
model.fit(X_train, y_train)

# --------------------------------------
# حفظ الموديل في ملف model.pkl
# --------------------------------------
with open("model.pkl", "wb") as f:
    pickle.dump(model, f)

# --------------------------------------
# تنزيل الملف على جهازك
# --------------------------------------
from google.colab import files
files.download("model.pkl")
